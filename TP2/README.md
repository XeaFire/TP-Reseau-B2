# TP 2

## I. Topologie réseau

### ☀  Sur node1.lan1.tp2

- afficher ses cartes réseau

``` bash
[tristan@node1 ~]$ hostname
node1.lan1.tp2
[tristan@node1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:c9:30:3f brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fec9:303f/64 scope link
       valid_lft forever preferred_lft forever
```

- afficher sa table de routage

``` bash
[tristan@node1 ~]$ ip route show
default via 10.1.1.254 dev enp0s8 proto static metric 100
10.1.1.0/24 dev enp0s8 proto kernel scope link src 10.1.1.11 metric 100
```

- prouvez qu'il peut joindre node2.lan2.tp2
``` bash
[tristan@node1 ~]$ ping 10.1.2.12
PING 10.1.2.12 (10.1.2.12) 56(84) bytes of data.
64 bytes from 10.1.2.12: icmp_seq=1 ttl=63 time=1.36 ms
64 bytes from 10.1.2.12: icmp_seq=2 ttl=63 time=2.58 ms
64 bytes from 10.1.2.12: icmp_seq=3 ttl=63 time=2.20 ms
^C
--- 10.1.2.12 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2005ms
rtt min/avg/max/mdev = 1.359/2.048/2.581/0.510 ms
[tristan@node1 ~]$
```

- prouvez avec un traceroute que le paquet passe bien par router.tp2

```bash
[tristan@node1 ~]$ traceroute 10.1.2.12
traceroute to 10.1.2.12 (10.1.2.12), 30 hops max, 60 byte packets
 1  _gateway (10.1.1.254)  0.893 ms  0.710 ms  0.659 ms
 2  10.1.2.12 (10.1.2.12)  2.626 ms !X  2.063 ms !X  3.049 ms !X
[tristan@node1 ~]$
```

## II. Interlude accès internet

- prouvez que vous avez un accès internet (ping d'une IP publique)
```bash
[tristan@routeur ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=113 time=20.5 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=113 time=20.8 ms
^C
--- 8.8.8.8 ping statistics ---
3 packets transmitted, 2 received, 33.3333% packet loss, time 2005ms
rtt min/avg/max/mdev = 20.510/20.671/20.833/0.161 ms
```

- prouvez que vous pouvez résoudre des noms publics (ping d'un nom de domaine public)

``` bash
PING google.com (216.58.214.78) 56(84) bytes of data.
64 bytes from fra15s10-in-f78.1e100.net (216.58.214.78): icmp_seq=1 ttl=116 time=20.0 ms
64 bytes from par10s39-in-f14.1e100.net (216.58.214.78): icmp_seq=2 ttl=116 time=21.9 ms
64 bytes from par10s39-in-f14.1e100.net (216.58.214.78): icmp_seq=3 ttl=116 time=21.6 ms
^C
--- google.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2005ms
rtt min/avg/max/mdev = 20.032/21.157/21.888/0.807 ms
[tristan@routeur ~]$
```

### ☀️ Accès internet LAN1 et LAN2

- dans le compte-rendu, mettez-moi que la conf des points précédents sur node2.lan1.tp2

``` bash
[tristan@node2 ~]$ hostname
node1.lan2.tp2
[tristan@node2 ~]$ cat /etc/sysc
sysconfig/   sysctl.conf  sysctl.d/
[tristan@node2 ~]$ cat /etc/sysconfig/network-scripts/route-enp0s8
default via 10.1.1.254 dev enp0s8
```

``` bash
[tristan@node2 ~]$ sudo cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 8.8.8.8
```


```bash
[tristan@node2 ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=2 ttl=112 time=25.4 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=112 time=23.2 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=112 time=24.5 ms
From 10.1.1.12 icmp_seq=1 Destination Host Unreachable
^C
--- 8.8.8.8 ping statistics ---
4 packets transmitted, 3 received, +1 errors, 25% packet loss, time 3063ms
rtt min/avg/max/mdev = 23.199/24.369/25.405/0.905 ms, pipe 4
```


``` bash
[tristan@node2 ~]$ ping google.com
PING google.com (216.58.214.78) 56(84) bytes of data.
64 bytes from par10s39-in-f14.1e100.net (216.58.214.78): icmp_seq=1 ttl=115 time=21.1 ms
64 bytes from fra15s10-in-f78.1e100.net (216.58.214.78): icmp_seq=2 ttl=115 time=22.4 ms
64 bytes from par10s39-in-f14.1e100.net (216.58.214.78): icmp_seq=3 ttl=115 time=21.9 ms
^C
--- google.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2005ms
rtt min/avg/max/mdev = 21.053/21.805/22.416/0.565 ms
```

## III. Services réseau

- et gérer les permissions correctement dessus

```bash 
[tristan@web nginx]$ ls -l /var/www/
total 0
drwxr-xr-x. 2 root root 24 Oct  4 11:19 site_nul
```
- prouvez que le firewall est bien configuré

- configuration NGINX (jl'avais fait sur la conf de base mais merci Léo pour la modif du conf.d)

```bash
[tristan@web nginx]$ cat /etc/nginx/conf.d/meow.conf
server {
  listen 80;
  server_name  site_nul.tp2;
  root /var/www/site_nul;
}
```
    
```bash
[tristan@web nginx]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s8
  sources:
  services: cockpit dhcpv6-client ssh
  ports: 80/tcp
  protocols:
  forward: yes
  masquerade: yes
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
```

- prouvez qu'il y a un programme NGINX qui tourne derrière le port 80 de la machine (commande ss)

``` bash
[tristan@web nginx]$ sudo ss -lntp
State      Recv-Q     Send-Q         Local Address:Port           Peer Address:Port     Process
LISTEN     0          511                  0.0.0.0:80                  0.0.0.0:*         users:(("nginx",pid=2197,fd=6),("nginx",pid=2196,fd=6))
LISTEN     0          128                  0.0.0.0:22                  0.0.0.0:*         users:(("sshd",pid=685,fd=3))
LISTEN     0          128                     [::]:22                     [::]:*         users:(("sshd",pid=685,fd=4))
```

### ☀️ Sur node1.lan1.tp2

- éditez le fichier hosts pour que site_nul.tp2 pointe vers l'IP de web.lan2.tp2

```bash
[tristan@node1 ~]$ cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
10.1.2.12       site_nul.tp2
```

- visitez le site nul avec une commande curl et en utilisant le nom site_nul.tp2

```bash
[tristan@node1 ~]$ curl site_nul.tp2
<h1> Ben
```